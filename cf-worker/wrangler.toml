# Cloudflare Workers Configuration for LLM-FW
# Usage: wrangler deploy

name = "llm-fw-edge"
main = "src/index.ts"
compatibility_date = "2024-02-08"
compatibility_flags = ["nodejs_compat"]
minify = true

# ==================== D1 DATABASE ====================
[[d1_databases]]
binding = "DB"
database_name = "llm-fw-prod-db"
database_id = "c71a50d0-561d-4746-9abe-1a991c0e204f"

# ==================== KV NAMESPACES ====================
[[kv_namespaces]]
binding = "CACHE"
id = "e352ca610a94443aa7ef7673b2c35906"

[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "4c55ac70bb204d4f8b00c31ea22164f2"

# ==================== R2 BUCKETS ====================
[[r2_buckets]]
binding = "LOGS"
bucket_name = "llm-fw-prod-logs"

# ==================== ENVIRONMENT VARIABLES ====================
[vars]
ENVIRONMENT = "production"
# JWT_SECRET — use `wrangler secret put JWT_SECRET`
# ML_BACKEND_URL — use `wrangler secret put ML_BACKEND_URL`
MAX_PAYLOAD_SIZE = "1048576"
DEFAULT_RATE_LIMIT = "100"
RATE_LIMIT_WINDOW = "60"

# ==================== SCHEDULED TRIGGERS ====================
[triggers]
crons = ["0 3 * * *"]

# ==================== OBSERVABILITY ====================
[observability]
enabled = true
head_sampling_rate = 1.0
